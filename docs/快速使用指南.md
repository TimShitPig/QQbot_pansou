# 🚀 增强版插件快速使用指南

## ✨ 功能特性

- ✅ 支持多种触发方式：`搜XX`、`求XX`、`搜索XX`、`找XX`
- ✅ 分页浏览：每页显示5个结果，支持翻页
- ✅ 显示序号和网盘类型（百度、夸克、UC、迅雷等）
- ✅ 选择转存：输入「第X个」或「X」选择资源
- ✅ 自动转存并返回链接

## 📝 使用流程

```
用户: 搜仙逆
机器人: 🔍 搜索结果（共 1265 个，第 1/253 页）

【1】仙逆剧场版神临之战.2025
    📦 百度网盘

【2】仙逆(2023)【最新一集】
    📦 百度网盘

【3】【短剧】仙逆（115集全集）
    📦 百度网盘

【4】仙逆
    📦 夸克网盘

【5】仙逆
    📦 UC网盘

💡 输入「下一页」或「上一页」翻页
💡 输入「第X个」或「X」选择资源

用户: 下一页
机器人: [显示第2页的5个结果]

用户: 第4个
机器人: ✅ 转存成功！

📝 标题: 仙逆
🔗 链接: https://pan.quark.cn/s/转存后的链接
🔑 提取码: 1234
📦 网盘: 夸克网盘
```

## 🔧 集成到 astrbot

### 最简单的集成方式

```python
from pansearch_enhanced import PanSearchPluginEnhanced
import json

# 1. 初始化插件（在机器人启动时）
with open('astrbot-pansou-transfer/config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)
plugin = PanSearchPluginEnhanced(config)

# 2. 在消息处理函数中使用
def on_message(message, user_id, group_id=None):
    """消息处理函数"""
    # 构建会话ID（群聊时使用 group_id + user_id）
    session_id = f"{group_id}_{user_id}" if group_id else user_id
    
    # 处理消息
    reply = plugin.handle_message(message, session_id)
    return reply
```

## 📋 支持的命令

### 搜索命令
- `搜XX` - 例如：搜仙逆
- `求XX` - 例如：求速度与激情
- `搜索XX` - 例如：搜索复仇者联盟
- `找XX` - 例如：找权力的游戏
- `/搜索XX` - 例如：/搜索仙逆

### 翻页命令
- `下一页` / `下一頁` / `next` / `下页`
- `上一页` / `上一頁` / `prev` / `previous` / `上页`

### 选择命令
- `第X个` / `第X個` - 例如：第1个、第4个
- `X` - 例如：1、4（直接输入数字）
- `选择X` / `選擇X` - 例如：选择1

## ⚙️ 配置文件

`config.json`:
```json
{
  "pansou_api_url": "http://154.12.83.97:8085",
  "ziliao_api_url": "https://www.ziliao.xyz",
  "ziliao_api_path": "/api/open/transfer",
  "ziliao_api_key": "",
  "max_results": 50,
  "timeout": 30
}
```

## 🎯 关键点

1. **用户ID**：必须为每个用户提供唯一的 user_id（用于会话管理）
2. **群聊处理**：群聊时建议使用 `group_id + user_id` 作为会话ID
3. **会话过期**：搜索结果10分钟后自动过期
4. **结果数量**：`max_results` 建议设置为 50 或更大

## 📦 文件说明

- `pansearch_enhanced.py` - 增强版插件（**使用这个**）
- `pansearch.py` - 基础版插件（已废弃）
- `astrbot_完整集成.py` - 完整集成示例

## ✅ 测试结果

✅ 搜索功能正常
✅ 分页功能正常
✅ 选择功能正常
✅ 转存功能正常

插件已完全就绪，可以直接使用！


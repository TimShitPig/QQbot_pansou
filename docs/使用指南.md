# ç½‘ç›˜æœç´¢è½¬å­˜æ’ä»¶ - è¯¦ç»†ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
3. [åŸºæœ¬ä½¿ç”¨](#åŸºæœ¬ä½¿ç”¨)
4. [é›†æˆåˆ° astrbot](#é›†æˆåˆ°-astrbot)
5. [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

```bash
# è¿›å…¥æ’ä»¶ç›®å½•
cd astrbot-pansou-transfer

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### æ­¥éª¤ 2: é…ç½®æ’ä»¶

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿
cp config.json.example config.json

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆä½¿ç”¨ä½ å–œæ¬¢çš„ç¼–è¾‘å™¨ï¼‰
# Windows: notepad config.json
# Linux/Mac: nano config.json æˆ– vim config.json
```

### æ­¥éª¤ 3: å¡«å†™é…ç½®ä¿¡æ¯

æ‰“å¼€ `config.json`ï¼Œå¡«å…¥ä½ çš„é…ç½®ï¼š

```json
{
  "pansou_api_url": "http://localhost:8888",
  "xinyue_api_url": "http://localhost",
  "xinyue_api_key": "your_api_key_here",
  "max_results": 5,
  "timeout": 30
}
```

**é…ç½®é¡¹è¯´æ˜**ï¼š
- `pansou_api_url`: pansou æœåŠ¡çš„åœ°å€ï¼ˆå¦‚æœ pansou è¿è¡Œåœ¨æœ¬æœºï¼Œé€šå¸¸æ˜¯ `http://localhost:8888`ï¼‰
- `xinyue_api_url`: xinyue æœåŠ¡çš„åœ°å€ï¼ˆå¦‚æœ xinyue è¿è¡Œåœ¨æœ¬æœºï¼Œé€šå¸¸æ˜¯ `http://localhost` æˆ– `http://localhost:80`ï¼‰
- `xinyue_api_key`: xinyue çš„ API å¯†é’¥ï¼ˆéœ€è¦ä» xinyue åå°è·å–ï¼‰
- `max_results`: æœ€å¤šè¿”å›å‡ ä¸ªè½¬å­˜ç»“æœï¼ˆå»ºè®® 3-5 ä¸ªï¼‰
- `timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 30 ç§’

### æ­¥éª¤ 4: è·å– xinyue API Key

1. ç™»å½• xinyue åå°ç®¡ç†ç³»ç»Ÿ
2. æ‰¾åˆ° API é…ç½®é¡µé¢ï¼ˆé€šå¸¸åœ¨ç³»ç»Ÿè®¾ç½®ä¸­ï¼‰
3. åˆ›å»ºæˆ–æŸ¥çœ‹ API Key
4. å°† API Key å¤åˆ¶åˆ° `config.json` çš„ `xinyue_api_key` å­—æ®µ

---

## ğŸ“ åŸºæœ¬ä½¿ç”¨

### æ–¹æ³• 1: ç›´æ¥è¿è¡Œæµ‹è¯•

```bash
# åœ¨æ’ä»¶ç›®å½•ä¸‹è¿è¡Œ
python pansearch.py
```

è¿™ä¼šæ‰§è¡Œå†…ç½®çš„æµ‹è¯•ä»£ç ï¼Œæœç´¢"é€Ÿåº¦ä¸æ¿€æƒ…"å¹¶è¾“å‡ºç»“æœã€‚

### æ–¹æ³• 2: åœ¨ Python ä»£ç ä¸­ä½¿ç”¨

```python
from pansearch import PanSearchPlugin
import json

# 1. åŠ è½½é…ç½®
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

# 2. åˆ›å»ºæ’ä»¶å®ä¾‹
plugin = PanSearchPlugin(config)

# 3. æœç´¢å¹¶è½¬å­˜
result = plugin.search_and_transfer("é€Ÿåº¦ä¸æ¿€æƒ…")
print(result)

# 4. æˆ–è€…ä½¿ç”¨ handle_message æ–¹æ³•ï¼ˆä¼šè‡ªåŠ¨å¤„ç†æ¶ˆæ¯ï¼‰
reply = plugin.handle_message("æœç´¢ å¤ä»‡è€…è”ç›Ÿ")
print(reply)
```

### æ–¹æ³• 3: ä½¿ç”¨ç¤ºä¾‹é›†æˆä»£ç 

```bash
# è¿è¡Œé›†æˆç¤ºä¾‹
python example_integration.py
```

---

## ğŸ¤– é›†æˆåˆ° astrbot

### æ–¹å¼ 1: ç®€å•é›†æˆï¼ˆæ¨èæ–°æ‰‹ï¼‰

åœ¨ä½ çš„ astrbot ä¸»æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```python
import json
from pansearch import PanSearchPlugin

# åœ¨æœºå™¨äººåˆå§‹åŒ–æ—¶åŠ è½½æ’ä»¶
def init_bot():
    # åŠ è½½é…ç½®
    with open('astrbot-pansou-transfer/config.json', 'r', encoding='utf-8') as f:
        config = json.load(f)
    
    # åˆ›å»ºæ’ä»¶å®ä¾‹ï¼ˆå…¨å±€å˜é‡ï¼‰
    global pansearch_plugin
    pansearch_plugin = PanSearchPlugin(config)
    print("ç½‘ç›˜æœç´¢æ’ä»¶åŠ è½½æˆåŠŸ")

# åœ¨æ¶ˆæ¯å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨
def on_message(message, user_id):
    # æ£€æµ‹æœç´¢å‘½ä»¤
    if message.startswith("/æœç´¢") or message.startswith("/search"):
        keyword = message.replace("/æœç´¢", "").replace("/search", "").strip()
        if keyword:
            result = pansearch_plugin.search_and_transfer(keyword)
            return result
        else:
            return "è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œä¾‹å¦‚ï¼š/æœç´¢ é€Ÿåº¦ä¸æ¿€æƒ…"
    
    return None  # ä¸å¤„ç†å…¶ä»–æ¶ˆæ¯
```

### æ–¹å¼ 2: åŸºäºå‘½ä»¤è§¦å‘

```python
from pansearch import PanSearchPlugin
import json

# åˆå§‹åŒ–æ’ä»¶
with open('astrbot-pansou-transfer/config.json', 'r', encoding='utf-8') as f:
    pansearch_config = json.load(f)
pansearch_plugin = PanSearchPlugin(pansearch_config)

# æ³¨å†Œå‘½ä»¤å¤„ç†å™¨
def register_commands():
    commands = {
        "/æœç´¢": handle_search,
        "/search": handle_search,
        "æœç´¢": handle_search,
        "æ‰¾èµ„æº": handle_search
    }
    return commands

def handle_search(message, user_id):
    """å¤„ç†æœç´¢å‘½ä»¤"""
    # æå–å…³é”®è¯
    keyword = message
    for trigger in ["/æœç´¢", "/search", "æœç´¢", "æ‰¾èµ„æº"]:
        if message.startswith(trigger):
            keyword = message.replace(trigger, "").strip()
            break
    
    if not keyword:
        return "è¯·è¾“å…¥æœç´¢å…³é”®è¯ï¼Œä¾‹å¦‚ï¼š/æœç´¢ é€Ÿåº¦ä¸æ¿€æƒ…"
    
    try:
        result = pansearch_plugin.search_and_transfer(keyword)
        return result
    except Exception as e:
        return f"âŒ æœç´¢å¤±è´¥: {str(e)}"
```

### æ–¹å¼ 3: å®Œæ•´é›†æˆç¤ºä¾‹

å‚è€ƒ `example_integration.py` æ–‡ä»¶ï¼Œé‡Œé¢æä¾›äº†ï¼š
- NoneBot2 é›†æˆç¤ºä¾‹
- go-cqhttp HTTP API é›†æˆç¤ºä¾‹
- ç®€å•çš„æ¶ˆæ¯å¤„ç†å‡½æ•°ç¤ºä¾‹

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯• 1: æµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®

```python
from pansearch import PanSearchPlugin
import json

# åŠ è½½é…ç½®
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

# åˆ›å»ºæ’ä»¶
plugin = PanSearchPlugin(config)

# æµ‹è¯•æœç´¢åŠŸèƒ½
print("æµ‹è¯•æœç´¢åŠŸèƒ½...")
search_result = plugin.search_resources("æµ‹è¯•")
print(f"æœç´¢ç»“æœ: {search_result}")

# æµ‹è¯•è½¬å­˜åŠŸèƒ½ï¼ˆéœ€è¦çœŸå®çš„ç½‘ç›˜é“¾æ¥ï¼‰
print("\næµ‹è¯•è½¬å­˜åŠŸèƒ½...")
transfer_result = plugin.transfer_link(
    "https://pan.baidu.com/s/1test123",
    "1234"
)
print(f"è½¬å­˜ç»“æœ: {transfer_result}")
```

### æµ‹è¯• 2: å®Œæ•´æµç¨‹æµ‹è¯•

```python
from pansearch import PanSearchPlugin
import json

# åŠ è½½é…ç½®
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

# åˆ›å»ºæ’ä»¶
plugin = PanSearchPlugin(config)

# æµ‹è¯•å®Œæ•´æµç¨‹
test_keywords = [
    "é€Ÿåº¦ä¸æ¿€æƒ…",
    "å¤ä»‡è€…è”ç›Ÿ",
    "æƒåŠ›çš„æ¸¸æˆ"
]

for keyword in test_keywords:
    print(f"\n{'='*50}")
    print(f"æµ‹è¯•å…³é”®è¯: {keyword}")
    print(f"{'='*50}")
    result = plugin.search_and_transfer(keyword)
    print(result)
```

### æµ‹è¯• 3: æ£€æŸ¥ API è¿æ¥

```python
import requests

# æµ‹è¯• pansou API
try:
    response = requests.get("http://localhost:8888/api/health", timeout=5)
    print(f"Pansou API çŠ¶æ€: {response.status_code}")
    print(f"å“åº”: {response.json()}")
except Exception as e:
    print(f"Pansou API è¿æ¥å¤±è´¥: {e}")

# æµ‹è¯• xinyue APIï¼ˆéœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
try:
    # è¿™é‡Œéœ€è¦æ ¹æ® xinyue çš„å®é™…å¥åº·æ£€æŸ¥æ¥å£è°ƒæ•´
    response = requests.get("http://localhost/api/health", timeout=5)
    print(f"Xinyue API çŠ¶æ€: {response.status_code}")
except Exception as e:
    print(f"Xinyue API è¿æ¥å¤±è´¥: {e}")
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®è®¤ pansou å’Œ xinyue æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Ÿ

**A**: ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ï¼š

```bash
# æµ‹è¯• pansou
curl http://localhost:8888/api/health

# æµ‹è¯• xinyueï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
curl http://localhost/api/health
```

### Q2: å¦‚ä½•è·å– xinyue çš„ API Keyï¼Ÿ

**A**: 
1. ç™»å½• xinyue åå°ç®¡ç†ç³»ç»Ÿ
2. è¿›å…¥"ç³»ç»Ÿè®¾ç½®" -> "API é…ç½®"
3. åˆ›å»ºæ–°çš„ API Key æˆ–æŸ¥çœ‹ç°æœ‰ Key
4. å¤åˆ¶ Key åˆ°é…ç½®æ–‡ä»¶

### Q3: æœç´¢è¿”å›"æœªæ‰¾åˆ°ç»“æœ"æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. æ£€æŸ¥ pansou æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. å°è¯•ä¸åŒçš„å…³é”®è¯
3. æ£€æŸ¥ pansou çš„é…ç½®ï¼Œç¡®è®¤å·²å¯ç”¨æœç´¢æ’ä»¶

### Q4: è½¬å­˜å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. æ£€æŸ¥ xinyue API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ xinyue æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œç¡®è®¤å…·ä½“é”™è¯¯ä¿¡æ¯
4. æŸäº›é“¾æ¥å¯èƒ½å·²ç»å¤±æ•ˆï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡

### Q5: å¦‚ä½•ä¿®æ”¹è¿”å›ç»“æœæ•°é‡ï¼Ÿ

**A**: åœ¨ `config.json` ä¸­ä¿®æ”¹ `max_results` å­—æ®µï¼š

```json
{
  "max_results": 3  // æ”¹ä¸ºä½ æƒ³è¦çš„æ•°é‡
}
```

### Q6: å¦‚ä½•æ·»åŠ æ›´å¤šç½‘ç›˜ç±»å‹æ”¯æŒï¼Ÿ

**A**: æ’ä»¶å·²ç»æ”¯æŒå¤šç§ç½‘ç›˜ç±»å‹ï¼ˆç™¾åº¦ã€é˜¿é‡Œã€å¤¸å…‹ç­‰ï¼‰ï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°çš„ç±»å‹ï¼Œéœ€è¦ä¿®æ”¹ `extract_links` æ–¹æ³•ä¸­çš„ `cloud_types` åˆ—è¡¨ã€‚

### Q7: å¦‚ä½•è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ï¼Ÿ

**A**: ä¿®æ”¹ `search_and_transfer` æ–¹æ³•ä¸­çš„è¾“å‡ºæ ¼å¼åŒ–éƒ¨åˆ†ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¼å¼åŒ–æ–¹æ³•ã€‚

### Q8: æ’ä»¶è¿è¡Œå¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: 
1. å‡å°‘ `max_results` æ•°é‡
2. å¢åŠ  `timeout` æ—¶é—´ï¼ˆå¦‚æœç½‘ç»œè¾ƒæ…¢ï¼‰
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. è€ƒè™‘æ·»åŠ ç¼“å­˜æœºåˆ¶

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œç¡®è®¤é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
4. æŸ¥çœ‹ README.md è·å–æ›´å¤šä¿¡æ¯

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•æœç´¢

```python
from pansearch import PanSearchPlugin
import json

# åŠ è½½é…ç½®
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

# åˆ›å»ºæ’ä»¶
plugin = PanSearchPlugin(config)

# æœç´¢
result = plugin.handle_message("æœç´¢ é€Ÿåº¦ä¸æ¿€æƒ…")
print(result)
```

### ç¤ºä¾‹ 2: æ‰¹é‡æœç´¢

```python
from pansearch import PanSearchPlugin
import json

# åˆå§‹åŒ–
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)
plugin = PanSearchPlugin(config)

# æ‰¹é‡æœç´¢
keywords = ["é€Ÿåº¦ä¸æ¿€æƒ…", "å¤ä»‡è€…è”ç›Ÿ", "æƒåŠ›çš„æ¸¸æˆ"]
for keyword in keywords:
    result = plugin.search_and_transfer(keyword)
    print(f"\n{result}\n")
    print("-" * 50)
```

### ç¤ºä¾‹ 3: é”™è¯¯å¤„ç†

```python
from pansearch import PanSearchPlugin
import json
import logging

# é…ç½®æ—¥å¿—
logging.basicConfig(level=logging.INFO)

# åˆå§‹åŒ–
with open('config.json', 'r', encoding='utf-8') as f:
    config = json.load(f)

try:
    plugin = PanSearchPlugin(config)
    result = plugin.search_and_transfer("æµ‹è¯•å…³é”®è¯")
    print(result)
except Exception as e:
    logging.error(f"æ’ä»¶è¿è¡Œå‡ºé”™: {e}")
    print(f"âŒ é”™è¯¯: {str(e)}")
```

---

## âœ… æ£€æŸ¥æ¸…å•

ä½¿ç”¨å‰è¯·ç¡®è®¤ï¼š

- [ ] å·²å®‰è£… Python 3.7+
- [ ] å·²å®‰è£… requests åº“ (`pip install requests`)
- [ ] å·²åˆ›å»ºå¹¶é…ç½® `config.json`
- [ ] pansou æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] xinyue æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å·²è·å– xinyue API Key
- [ ] å·²æµ‹è¯• API è¿æ¥

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ å°±å¯ä»¥å¼€å§‹ä½¿ç”¨æ’ä»¶äº†ï¼

